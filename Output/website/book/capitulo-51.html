<!doctype html>
<html lang="es">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="author" content="Juan Salvador Aleixandre" />
    <meta name="date" content="09/11/2015"/>
    <meta name="generator" content="easybook 4.9.0"/>

    <title>Líneas mínimas a añadir al código del Industruino para usar las librerías m2tklib | Blog Cosillas de Juansal</title>

    <link rel="stylesheet" href="./css/easybook.css" />

</head>

<body class="item chapter">
<div class="container">
<div class="menu">
    <div class="row">
        <h1 class="span9"><a href="./index.html">Blog Cosillas de Juansal</a></h1>
        <p class="span3">
                        <a href="./capitulo-5.html"><span>&larr;</span> Anterior</a>
            
                        <a href="./capitulo-51.html">Siguiente <span>&rarr;</span></a>
                    </p>
    </div>
</div>

<div class="row">
    <div class="span9">
        <h1 id="2014_01"><span>Capítulo 5.1</span> Líneas mínimas a añadir al código del Industruino para usar las librerías m2tklib</h1>
        <p>Según mi experiencia creando menús y formularios dentro del Industruino usando las librerías m2tklib, el código mínimo a añadir a un fichero de código es el siguiente:</p>

<h3 id="includes-minimos">5.1.0.1 Includes mínimos</h3>

<p>``` c++</p>

<h1 id="include-ltu8glibh">Capítulo 5.1 include &lt;U8glib.h></h1>

<h1 id="include-ltm2tkh">Capítulo 5.1 include &lt;M2tk.h></h1>

<h1 id="include-ltutility-m2ghu8gh">Capítulo 5.1 include &lt;utility/m2ghu8g.h></h1>

<div class="code code">
<pre class="code">&nbsp;
&nbsp;
### Declaración del tipo de pantalla
&nbsp;
Esta declaración se ha de descomentar, si ya está o añadir al código.
&nbsp;
``` c++
U8GLIB_MINI12864 u8g(21, 20, 19, 22);</pre>
</div>

<h3 id="gestion-de-botones">5.1.0.1 Gestión de botones</h3>

<p>``` c++
uint8_t uiKeyUpPin = 7;
uint8_t uiKeyDownPin = 3;
uint8_t uiKeySelectPin = 2;
uint8_t uiKeyExitPin = 0;</p>

<p>int adc_key_in = 0;</p>

<p>int read_LCD_buttons_original() //routine to check button inputs and pass the correct button event to GUI
{</p>

<p>adc_key_in = analogRead(A5);  // read the value from the sensor
  delay(5); //switch debounce delay. Increase this delay if incorrect switch selections are returned.
  if (adc_key_in &lt; 100) return M2_KEY_NONE; // We make this the 1st option for speed reasons since it will be the most likely result
  if (adc_key_in > 300 &amp;&amp; adc_key_in &lt; 315)  return M2_KEY_PREV;
  if (adc_key_in > 600 &amp;&amp; adc_key_in &lt; 630)  return M2_KEY_SELECT;
  if (adc_key_in > 700 &amp;&amp; adc_key_in &lt; 930)  return M2_KEY_NEXT;</p>

<p>}</p>

<p>uint8_t m2_es_arduino_analog_input(m2_p ep, uint8_t msg)
{
  switch (msg)
  {
case M2_ES_MSG_GET_KEY:
  return read_LCD_buttons_original();
case M2_ES_MSG_INIT:
  return 0;
  }
  return 0;
}</p>

<div class="code code">
<pre class="code">&nbsp;
### A incluir dentro del método setup()
&nbsp;
``` c++
void industruino_Menu_setup(void) {
&nbsp;
  //flip the screen 180°
  u8g.setRot180();
  // Connect u8glib with m2tklib
  m2_SetU8g(u8g.getU8g(), m2_u8g_box_icon);
&nbsp;
  // Assign u8g font to index 0
  m2.setFont(0, u8g_font_6x13r);
&nbsp;
  // Assign icon font to index 3
  m2.setFont(3, u8g_font_m2icon_7);
&nbsp;
}</pre>
</div>

<h3 id="metodo-loop">5.1.0.2 Método loop()</h3>

<p>``` c++
void industruino_Menu_loop() {
  // menu management
  m2.checkKey();
  if ( m2.handleKey() != 0 ) {
u8g.firstPage();
do {
  m2.checkKey();
  draw();
} while ( u8g.nextPage() );
  }
}</p>

<div class="code code">
<pre class="code">&nbsp;
### Métodos adicionales a añadir
&nbsp;
``` c++
Método draw:
&nbsp;
void draw(void) {
  m2.draw();
}</pre>
</div>

    </div>

    <div class="span3">
        <div class="item local_toc">
            <h3>Índice de contenidos</h3>

            <ul class="unstyled">
                                                <li class="level-1">
                        <span></span>
                        <a class="internal" href="./capitulo-51.html#2014_01">Líneas mínimas a añadir al código del Industruino para usar las librerías m2tklib</a>
                    </li>
                                    <li class="level-1">
                        <span></span>
                        <a class="internal" href="./capitulo-51.html#include-ltu8glibh">include &lt;U8glib.h></a>
                    </li>
                                    <li class="level-1">
                        <span></span>
                        <a class="internal" href="./capitulo-51.html#include-ltm2tkh">include &lt;M2tk.h></a>
                    </li>
                                    <li class="level-1">
                        <span></span>
                        <a class="internal" href="./capitulo-51.html#include-ltutility-m2ghu8gh">include &lt;utility/m2ghu8g.h></a>
                    </li>
                                        </ul>
        </div>
    </div>
</div>
</div>
</body>
</html>